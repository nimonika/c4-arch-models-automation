name: Check Docker + Structurizr CLI

on:
  push:
    branches: [ "main" ]   # you can change this to any branch
  pull_request:

jobs:
  check-docker-structurizr:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Check Docker availability
        run: |
          if command -v docker &> /dev/null; then
            echo "‚úÖ Docker is installed"
            docker --version
          else
            echo "‚ùå Docker is NOT installed"
            exit 1
          fi

      - name: Test Structurizr CLI image
        run: |
          echo "Pulling Structurizr CLI image..."
          docker pull structurizr/cli:latest
          
          echo "Running Structurizr CLI version command..."
          docker run --rm structurizr/cli:latest version
      - name: Validate all DSL files
        run: |
          echo "üîé Validating all .dsl files in repository..."
          for file in $(find . -name "*.dsl"); do
            echo "Validating $file ..."
            docker run --rm -v $PWD:/workspace structurizr/cli:latest validate -workspace /workspace/$file
          done